// auto generated by https://github.com/sakura-rip/mongodb-gen
// Version : develop@v1
// DO NOT EDIT

package dao

import (
	"github.com/sakura-rip/mongodbgen/sample"
	"go.mongodb.org/mongo-driver/bson"
	"go.mongodb.org/mongo-driver/mongo/options"
)

func (cl *UserDaoClient) DeleteOne(id string) (int64, error) {
	result, err := cl.Col.DeleteOne(cl.ctx, bson.M{"_id": id})
	if err != nil {
		return 0, err
	}
	return result.DeletedCount, err
}

func (cl *UserDaoClient) DeleteMany(attr bson.M) (int64, error) {
	result, err := cl.Col.DeleteMany(cl.ctx, attr)
	if err != nil {
		return 0, err
	}
	return result.DeletedCount, err
}

func (cl *UserDaoClient) InsertOne(user *sample.User) (string, error) {
	result, err := cl.Col.InsertOne(cl.ctx, user)
	if err != nil {
		return "", err
	}
	if oid, ok := result.InsertedID.(string); ok {
		return oid, nil
	}
	return "", nil
}

func (cl *UserDaoClient) InsertMany(objs []interface{}) ([]string, error) {
	result, err := cl.Col.InsertMany(cl.ctx, objs)
	if err != nil {
		return nil, err
	}
	var strIds []string
	for _, id := range result.InsertedIDs {
		strIds = append(strIds, id.(string))
		return strIds, nil
	}
	return strIds, nil
}

func (cl *UserDaoClient) UpdateAttribute(id string, attrToUpdate bson.M) error {
	_, err := cl.Col.UpdateOne(cl.ctx, bson.M{"_id": id}, Set(attrToUpdate))
	return err
}

func (cl *UserDaoClient) DeleteAttributes(id string, attrToDelete bson.M) error {
	_, err := cl.Col.UpdateOne(cl.ctx, bson.M{"_id": id}, Unset(attrToDelete))
	return err
}

func (cl *UserDaoClient) AddToArray(id string, object bson.M) error {
	_, err := cl.Col.UpdateOne(cl.ctx, bson.M{"_id": id}, AddToSet(object))
	return err
}

func (cl *UserDaoClient) RemoveFromArray(id string, object bson.M) error {
	_, err := cl.Col.UpdateOne(cl.ctx, bson.M{"_id": id}, Pull(object))
	return err
}

func (cl *UserDaoClient) Get(filter bson.M) ([]sample.User, error) {
	res, err := cl.Col.Find(
		cl.ctx, filter)
	if err != nil {
		return nil, err
	}
	var users []sample.User
	if err := res.All(cl.ctx, &users); err != nil {
		return nil, err
	}
	return users, err
}

func (cl *UserDaoClient) GetUser(id string) (sample.User, error) {
	res := cl.Col.FindOne(
		cl.ctx,
		bson.D{{"_id", id}},
	)
	var user sample.User
	if err := res.Decode(&user); err != nil {
		return user, err
	}

	return user, nil
}

func (cl *UserDaoClient) GetAll() ([]sample.User, error) {
	return cl.Get(bson.M{})
}

func (cl *UserDaoClient) GetAttribute(id string, attributes bson.D) (sample.User, error) {
	res := cl.Col.FindOne(
		cl.ctx,
		bson.D{{"_id", id}},
		options.FindOne().SetProjection(attributes),
	)
	var user sample.User
	if err := res.Decode(&user); err != nil {
		return user, err
	}
	return user, nil
}

func (cl *UserDaoClient) GetAttributes(id string, attributes ...string) (sample.User, error) {
	var projections = bson.D{}
	for _, attribute := range attributes {
		projections = append(projections, bson.E{Key: attribute, Value: 1})
	}
	return cl.GetAttribute(id, projections)
}
